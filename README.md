# mx-releases

> Central release coordination for the MemNexus platform

[![Platform Version](https://img.shields.io/badge/platform-1.0.0-blue)](https://github.com/memnexus-ai/mx-releases)
[![Generated Packages](https://img.shields.io/badge/generated-1.0.0-green)](https://github.com/memnexus-ai/mx-releases)

## Overview

This repository serves as the **single source of truth** for:
- âœ… OpenAPI specifications
- âœ… Platform versioning and component compatibility
- âœ… Generated packages (SDK, CLI, MCP Server)
- âœ… Coordinated releases across all MemNexus components

**Key Principle:** All client-facing packages (SDK, CLI, MCP Server) are generated from the same OpenAPI spec using [liblab](https://www.liblab.com) and share the same version number, ensuring consistency across all interfaces to the MemNexus API.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   mx-core-api   â”‚     â”‚  mx-api-gateway â”‚     â”‚              mx-releases                â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚                                         â”‚
â”‚ deploy-core-    â”‚â”€â”€â”€â”€â–¶â”‚ deploy-         â”‚â”€â”€â”€â”€â–¶â”‚  specs/openapi.yaml                     â”‚
â”‚ api.yml         â”‚trig â”‚ gateway.yml     â”‚push â”‚                                         â”‚
â”‚ (deploys +      â”‚ger  â”‚ (update routes) â”‚spec â”‚  packages/                              â”‚
â”‚  triggers gw)   â”‚     â”‚                 â”‚     â”‚    sdk/ (@memnexus-ai/sdk)              â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚    cli/ (@memnexus-ai/cli)              â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚    mcp/ (@memnexus-ai/mcp-server)       â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚                                         â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚  VERSION.yaml                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Repository Structure

```
mx-releases/
â”œâ”€â”€ README.md                     # This file
â”œâ”€â”€ VERSION.yaml                  # Single source of truth for versions
â”œâ”€â”€ CHANGELOG.md                  # Platform-wide changelog
â”œâ”€â”€ liblab.config.json            # liblab configuration for package generation
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ sdk/                      # @memnexus-ai/sdk (generated by liblab)
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ src/                  # Generated TypeScript SDK
â”‚   â”‚   â””â”€â”€ tests/
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/                      # @memnexus-ai/cli (generated by liblab)
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ src/                  # Generated CLI commands
â”‚   â”‚   â”œâ”€â”€ bin/
â”‚   â”‚   â””â”€â”€ tests/
â”‚   â”‚
â”‚   â””â”€â”€ mcp/                      # @memnexus-ai/mcp-server (generated by liblab)
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ src/                  # Generated MCP server
â”‚       â”œâ”€â”€ bin/
â”‚       â””â”€â”€ tests/
â”‚
â”œâ”€â”€ specs/
â”‚   â”œâ”€â”€ openapi.yaml              # Current/latest OpenAPI spec
â”‚   â””â”€â”€ archive/                  # Historical specs for reference
â”‚       â”œâ”€â”€ openapi-1.0.0.yaml
â”‚       â””â”€â”€ openapi-1.1.0.yaml
â”‚
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â”œâ”€â”€ determine-version.yml          # Analyze spec changes, determine version
        â”œâ”€â”€ generate-publish-packages.yml  # Generate SDK/CLI/MCP, publish to npm
        â”œâ”€â”€ sync-postman.yml               # Sync to Postman
        â”œâ”€â”€ finalize-release.yml           # Create platform release
        â”œâ”€â”€ manual-release.yml             # Manual release trigger
        â””â”€â”€ ci.yml                         # PR validation
```

## Published Packages

All packages are published to the public npm registry ([npmjs.com](https://www.npmjs.com)) and share the same version number.

| Package | Description | npm |
|---------|-------------|-----|
| **@memnexus-ai/sdk** | TypeScript SDK for programmatic API access | [![npm](https://img.shields.io/npm/v/@memnexus-ai/sdk)](https://www.npmjs.com/package/@memnexus-ai/sdk) |
| **@memnexus-ai/cli** | Command-line interface for terminal users | [![npm](https://img.shields.io/npm/v/@memnexus-ai/cli)](https://www.npmjs.com/package/@memnexus-ai/cli) |
| **@memnexus-ai/mcp-server** | MCP server for AI agent integration | [![npm](https://img.shields.io/npm/v/@memnexus-ai/mcp-server)](https://www.npmjs.com/package/@memnexus-ai/mcp-server) |

### Installation

```bash
# SDK for Node.js/TypeScript applications
npm install @memnexus-ai/sdk

# CLI for command-line usage
npm install -g @memnexus-ai/cli

# MCP Server for AI agents (Claude Desktop, etc.)
npm install @memnexus-ai/mcp-server
```

## How It Works

### Automated Release Pipeline (7 Phases)

1. **Phase 1: Test & Deploy** (mx-core-api)
   - Developer pushes changes to mx-core-api
   - Tests run, Docker image builds, deploys to dev
   - Dispatches to mx-api-gateway on success

2. **Phase 2: Update Gateway Routes** (mx-api-gateway)
   - Receives dispatch from core-api
   - Updates Kong gateway configuration
   - Validates routes are working

3. **Phase 3: Sync OpenAPI Spec** (mx-api-gateway â†’ mx-releases)
   - Fetches spec from deployed Core API (`/api-docs-json`)
   - Validates spec (openapi-generator, spectral)
   - Pushes validated spec to `mx-releases/specs/openapi.yaml`

4. **Phase 4: Determine Version** (mx-releases)
   - Analyzes spec changes vs. previous version
   - Determines version bump (major/minor/patch)
   - Uses `openapi-diff` for breaking change detection

5. **Phase 5: Generate & Publish** (mx-releases)
   - Runs liblab to generate SDK, CLI, and MCP Server
   - All three packages generated in single operation
   - Tests all packages (unit + E2E)
   - Publishes all to npmjs.com with same version

6. **Phase 6: Sync Postman** (mx-releases)
   - Updates Postman Spec Hub
   - Updates Postman Collection

7. **Phase 7: Finalize Release** (mx-releases)
   - Updates VERSION.yaml
   - Updates CHANGELOG.md
   - Creates platform release on GitHub

### Unified Versioning

All generated packages (SDK, CLI, MCP) share the same version number because:
- They're all generated from the **same OpenAPI spec**
- They're generated in a **single liblab operation**
- They represent the **same API surface**
- They're released **atomically** (all together or none)

This ensures perfect compatibility and eliminates version confusion.

## VERSION.yaml

The [`VERSION.yaml`](./VERSION.yaml) file is the single source of truth for all component versions:

```yaml
platform: 1.0.0                    # Overall platform version

generated:
  version: 1.0.0                   # Shared version for SDK, CLI, MCP
  spec_version: 1.0.0              # OpenAPI spec version

components:
  core-api:
    version: 1.0.0
  gateway:
    version: 1.0.0
```

## Development Workflow

### For API Changes

1. **Update Core API** - Add/modify endpoints with OpenAPI decorators
2. **Push to main** - Triggers deployment and full pipeline
3. **Wait for pipeline** - Automated process runs (typically < 30 minutes)
4. **Verify packages** - Check npmjs.com for new published versions
5. **Update consumers** - Applications can upgrade to new SDK/CLI/MCP

### For Manual Releases

Use the manual release workflow when you need to:
- Force a specific version number
- Re-release without API changes
- Test the release pipeline

```bash
# Trigger via GitHub Actions UI
# Go to Actions â†’ Manual Release â†’ Run workflow
# Specify version and publish options
```

## Component Repositories

| Repository | Description | Version |
|------------|-------------|---------|
| [mx-core-api](https://github.com/memnexus-ai/mx-core-api) | Core API service | ![](https://img.shields.io/badge/v-1.0.0-blue) |
| [mx-api-gateway](https://github.com/memnexus-ai/mx-api-gateway) | Kong API Gateway | ![](https://img.shields.io/badge/v-1.0.0-blue) |
| [mx-releases](https://github.com/memnexus-ai/mx-releases) | Release coordination (this repo) | ![](https://img.shields.io/badge/v-1.0.0-green) |

## Migration from Old Packages

### @memnexus-ai/contracts â†’ @memnexus-ai/sdk

The old `@memnexus-ai/contracts` package has been replaced by `@memnexus-ai/sdk`.

**Before:**
```typescript
import { MemNexusClient } from '@memnexus-ai/contracts';
```

**After:**
```typescript
import { MemNexusClient } from '@memnexus-ai/sdk';
```

**Migration steps:**
1. Replace `@memnexus-ai/contracts` with `@memnexus-ai/sdk` in package.json
2. Update imports in your code
3. Test your application
4. The API is identical - only the package name changed

## Release Versioning Strategy

We follow [Semantic Versioning 2.0.0](https://semver.org/):

- **MAJOR** (X.0.0) - Breaking changes
  - Removed endpoints
  - Changed required fields
  - Renamed paths
  - Incompatible API changes

- **MINOR** (0.X.0) - New features (backward-compatible)
  - New endpoints
  - New optional fields
  - Performance improvements

- **PATCH** (0.0.X) - Bug fixes (backward-compatible)
  - Bug fixes
  - Documentation updates
  - Non-functional changes

Version bumps are **automatically determined** by analyzing OpenAPI spec changes using `openapi-diff`, but can be manually overridden if needed.

## Contributing

### Reporting Issues

- **SDK/CLI/MCP issues**: Open in this repository
- **API functionality issues**: Open in [mx-core-api](https://github.com/memnexus-ai/mx-core-api)
- **Gateway/routing issues**: Open in [mx-api-gateway](https://github.com/memnexus-ai/mx-api-gateway)

### Pull Requests

This repository is primarily automated. Manual PRs are typically only needed for:
- Documentation updates
- Workflow improvements
- liblab configuration changes

## Support

- **Documentation**: [docs.memnexus.ai](https://docs.memnexus.ai)
- **Issues**: [GitHub Issues](https://github.com/memnexus-ai/mx-releases/issues)
- **Discussions**: [GitHub Discussions](https://github.com/memnexus-ai/mx-releases/discussions)

## License

Copyright Â© 2025 MemNexus AI

---

**Status**: ğŸš€ Active Development

For detailed implementation plan, see [mx-api-gateway Issue #16](https://github.com/memnexus-ai/mx-api-gateway/issues/16)
